<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ey Buddy Mobile Mechanic Booking</title>
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f7f8fa;
    color: #001f3f;
  }
  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Dashboard lights top bar */
  #dashboard {
    height: 12.5vh;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    user-select: none;
  }
  .light {
    width: 30px; height: 30px;
    border-radius: 50%;
    opacity: 0.4;
    transition: opacity 0.3s;
  }
  .oil { background: red; }
  .engine { background: orange; }
  .fuel { background: yellow; }
  .abs { background: #ff6600; }

  /* Main area with start button */
  #main {
    flex-grow: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f7f8fa;
    flex-direction: column;
  }
  #startBtn {
    width: 120px; height: 120px;
    border-radius: 50%;
    border: none;
    background: limegreen;
    box-shadow: 0 0 20px limegreen;
    font-size: 1.4rem;
    font-weight: bold;
    cursor: pointer;
    animation: pulse 2s infinite;
    color: #003300;
  }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 10px limegreen; }
    50% { box-shadow: 0 0 30px limegreen; }
  }

  /* Terms popup */
  #termsPopup {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #termsContent {
    background: white;
    padding: 25px;
    border-radius: 10px;
    max-width: 500px;
    text-align: center;
    font-size: 1.1rem;
  }
  #termsContent button {
    margin-top: 20px;
    background: #1abc9c;
    border: none;
    color: white;
    padding: 12px 25px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 1.1rem;
    transition: background 0.3s ease;
  }
  #termsContent button:hover {
    background: #159e85;
  }

  /* Booking Container holds form and cart */
  #bookingContainer {
    display: flex;
    gap: 20px;
    max-width: 960px;
    margin: 20px auto 60px auto;
    padding: 0 10px;
    height: calc(100vh - 12.5vh - 40px); /* full remaining height minus dashboard and margin */
  }

  /* Booking Form */
  #bookingForm {
    flex: 1 1 60%;
    background: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-radius: 10px;
    display: none;
    flex-direction: column;
    padding: 20px;
    overflow-y: auto;
    max-height: 100%;
    margin: 0;
  }
  #bookingForm h2 {
    margin-top: 0;
    color: #003366;
  }
  #bookingForm label {
    display: block;
    margin-top: 12px;
    font-weight: 700;
    color: #003366;
  }
  #bookingForm select,
  #bookingForm input:not(#numberPlate) {
    width: 100%;
    padding: 10px 12px;
    margin-top: 6px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }

  /* Number Plate Styling */
  .plate {
    display: flex;
    align-items: center;
    background: #ffcc00;
    border: 2px solid black;
    border-radius: 4px;
    font-family: 'Arial Black', 'Arial Bold', Gadget, sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
    color: black;
    padding: 6px 12px;
    justify-content: flex-start;
    user-select: none;
  }
  .plate .gb {
    background: #003399;
    color: white;
    font-weight: bold;
    font-size: 0.8rem;
    padding: 6px 10px;
    margin-right: 10px;
    border-radius: 2px 0 0 2px;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  .plate .gb span {
    font-size: 1.2rem;
    line-height: 1;
  }

  #numberPlate {
    border: none;
    background: transparent;
    font-family: 'Arial Black', 'Arial Bold', Gadget, sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
    color: black;
    outline: none;
    width: 120px;
    text-transform: uppercase;
    caret-color: black;
    user-select: text;
  }

  /* Floating Cart */
  #cart {
    flex: 0 0 320px;
    background: white;
    border: 3px solid #1abc9c;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.25);
    display: none;
    padding: 15px 20px 20px 20px;
    font-size: 0.95rem;
    color: #003366;
    max-height: 100%;
    overflow-y: auto;
    position: relative;
  }
  #cart h3 {
    margin: 0 0 10px 0;
    font-size: 1.2rem;
    color: #1abc9c;
    font-weight: 700;
    user-select: none;
  }
  .cart-item {
    margin-bottom: 8px;
  }
  .cart-total {
    font-weight: 700;
    margin-top: 15px;
    font-size: 1.15rem;
  }
  .cart-savings {
    color: green;
    font-weight: 600;
    margin-top: 4px;
  }
  #cartCloseBtn {
    position: absolute;
    top: 8px;
    right: 12px;
    background: transparent;
    border: none;
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
    color: #1abc9c;
    user-select: none;
  }
  #cartCloseBtn:hover {
    color: #159e85;
  }

  /* Floating Cart Toggle Button */
  #cartToggleBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #1abc9c;
    color: white;
    font-size: 2rem;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 15px #1abc9c;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1001;
  }
  #cartToggleBtn:hover {
    background: #159e85;
  }

  /* Booking container responsiveness */
  @media (max-width: 900px) {
    #bookingContainer {
      flex-direction: column;
      height: auto;
    }
    #bookingForm, #cart {
      flex: none;
      max-width: 100%;
      width: 100%;
      margin-bottom: 20px;
      max-height: 400px;
    }
    #cartToggleBtn {
      bottom: 10px;
      right: 10px;
      width: 50px;
      height: 50px;
      font-size: 1.6rem;
    }
  }
</style>
</head>
<body>

<!-- Dashboard Lights -->
<div id="dashboard" aria-label="Dashboard warning lights">
  <div class="light oil" aria-label="Oil warning light"></div>
  <div class="light engine" aria-label="Engine management light"></div>
  <div class="light fuel" aria-label="Fuel warning light"></div>
  <div class="light abs" aria-label="ABS warning light"></div>
</div>

<!-- Main area with start button -->
<div id="main" aria-label="Start booking area">
  <button id="startBtn" aria-label="Start booking button">START</button>
</div>

<!-- Terms popup -->
<div id="termsPopup" role="dialog" aria-modal="true" aria-labelledby="termsTitle" aria-describedby="termsDesc">
  <div id="termsContent">
    <h2 id="termsTitle">Terms & Conditions</h2>
    <p id="termsDesc">Please agree to the terms and conditions before booking your service.</p>
    <button id="agreeBtn" aria-label="Agree to terms and proceed">I Agree</button>
  </div>
</div>

<!-- Booking container -->
<div id="bookingContainer">

  <!-- Booking form -->
  <form id="bookingForm" role="form" aria-label="Booking form">
    <!-- Number plate input styled as plate -->
    <div class="plate" aria-label="Vehicle number plate input">
      <div class="gb" aria-hidden="true"><span>ðŸ‡¬ðŸ‡§</span>GB</div>
      <input
        id="numberPlate"
        name="numberPlate"
        type="text"
        maxlength="8"
        placeholder="AB12 CDE"
        autocomplete="off"
        spellcheck="false"
        aria-required="true"
        aria-describedby="plateHelp"
        required
      />
    </div>
    <small id="plateHelp" style="color:#666;">Enter your vehicle registration number here</small>

    <h2>Book a Service</h2>

    <label for="carMake">Car Make</label>
    <input id="carMake" name="carMake" type="text" placeholder="e.g. BMW" autocomplete="off" required />

    <label for="carModel">Car Model</label>
    <input id="carModel" name="carModel" type="text" placeholder="e.g. 118i" autocomplete="off" required />

    <label for="serviceSelect">Select Service</label>
    <select id="serviceSelect" name="service" aria-label="Select Service" required>
      <option value="">-- Select --</option>
      <!-- options will be added dynamically -->
    </select>

    <label for="customerName">Your Name</label>
    <input id="customerName" name="customerName" type="text" placeholder="Full Name" autocomplete="off" required />

    <label for="phoneNumber">Phone Number</label>
    <input id="phoneNumber" name="phoneNumber" type="tel" placeholder="07123 456789" autocomplete="off" required />

    <label for="dateSelect">Preferred Date</label>
    <input id="dateSelect" name="dateSelect" type="date" required />

    <button type="submit" style="margin-top: 20px; background: #1abc9c; color: white; font-weight: 700; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 1.1rem;">Book Now</button>
  </form>

  <!-- Cart -->
  <div id="cart" aria-label="Booking cart">
    <button id="cartCloseBtn" aria-label="Close cart">&times;</button>
    <h3>Your Booking</h3>
    <div id="cartPlate" class="plate" aria-live="polite" aria-atomic="true">
      <div class="gb" aria-hidden="true"><span>ðŸ‡¬ðŸ‡§</span>GB</div>
      <span id="cartNumberPlate" style="margin-left:10px;">--</span>
    </div>
    <div id="cartItems"></div>
    <div class="cart-total" id="cartTotal"></div>
    <div class="cart-savings" id="cartSavings"></div>
  </div>

</div>

<!-- Floating Cart Toggle Button -->
<button id="cartToggleBtn" aria-label="Toggle booking cart">&#128722;</button>

<script>
  const startBtn = document.getElementById('startBtn');
  const termsPopup = document.getElementById('termsPopup');
  const agreeBtn = document.getElementById('agreeBtn');
  const main = document.getElementById('main');
  const bookingForm = document.getElementById('bookingForm');
  const dashboard = document.getElementById('dashboard');

  const serviceSelect = document.getElementById('serviceSelect');
  const cart = document.getElementById('cart');
  const cartToggleBtn = document.getElementById('cartToggleBtn');
  const cartCloseBtn = document.getElementById('cartCloseBtn');
  const cartItemsDiv = document.getElementById('cartItems');
  const cartTotalDiv = document.getElementById('cartTotal');
  const cartSavingsDiv = document.getElementById('cartSavings');
  const numberPlateInput = document.getElementById('numberPlate');
  const cartNumberPlate = document.getElementById('cartNumberPlate');

  // Sample services with price & usual price for savings
  const services = [
    {id:'service', name: 'Service', price: 70, usualPrice: 100},
    {id:'mot', name: 'MOT Pre-Check', price: 45, usualPrice: 60},
    {id:'oilchange', name: 'Oil Change', price: 50, usualPrice: 65},
    {id:'brakes', name: 'Brake Inspection', price: 40, usualPrice: 55},
    {id:'battery', name: 'Battery Test', price: 30, usualPrice: 45}
  ];

  // Populate service select options
  function populateServices() {
    services.forEach(s => {
      const opt = document.createElement('option');
      opt.value = s.id;
      opt.textContent = `${s.name} - Â£${s.price} (Save Â£${s.usualPrice - s.price})`;
      serviceSelect.appendChild(opt);
    });
  }

  populateServices();

  // Booking data model
  let booking = {
    numberPlate: '',
    carMake: '',
    carModel: '',
    selectedServices: [],
    customerName: '',
    phoneNumber: '',
    dateSelect: ''
  };

  // Update cart display
  function updateCart() {
    booking.numberPlate = numberPlateInput.value.trim().toUpperCase();
    cartNumberPlate.textContent = booking.numberPlate || '--';

    // Show/hide cart toggle button if services selected
    if (booking.selectedServices.length > 0) {
      cartToggleBtn.style.display = 'flex';
    } else {
      cartToggleBtn.style.display = 'none';
      cart.style.display = 'none';
    }

    // Update cart items
    cartItemsDiv.innerHTML = '';
    let total = 0;
    let savings = 0;
    booking.selectedServices.forEach(id => {
      const svc = services.find(s => s.id === id);
      if (svc) {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.textContent = `${svc.name}: Â£${svc.price}`;
        cartItemsDiv.appendChild(div);
        total += svc.price;
        savings += (svc.usualPrice - svc.price);
      }
    });

    cartTotalDiv.textContent = `Total: Â£${total.toFixed(2)}`;
    cartSavingsDiv.textContent = savings > 0 ? `You save Â£${savings.toFixed(2)}!` : '';
  }

  // Service select handler
  serviceSelect.addEventListener('change', e => {
    const val = e.target.value;
    if (!booking.selectedServices.includes(val) && val) {
      booking.selectedServices.push(val);
    }
    // Reset select back to placeholder
    e.target.value = '';
    updateCart();
  });

  // Cart toggle handlers
  cartToggleBtn.addEventListener('click', () => {
    if (cart.style.display === 'block') {
      cart.style.display = 'none';
    } else {
      cart.style.display = 'block';
    }
  });
  cartCloseBtn.addEventListener('click', () => {
    cart.style.display = 'none';
  });

  // Start button handler
  startBtn.addEventListener('click', () => {
    // Flash lights animation
    const lights = document.querySelectorAll('.light');
    let flashes = 0;
    const maxFlashes = 4;
    const flashInterval = setInterval(() => {
      lights.forEach(l => l.style.opacity = l.style.opacity === '1' ? '0.4' : '1');
      flashes++;
      if (flashes >= maxFlashes) {
        clearInterval(flashInterval);
        // Hide main & show terms popup
        main.style.display = 'none';
        termsPopup.style.display = 'flex';
        // Turn lights off
        lights.forEach(l => l.style.opacity = '0.4');
      }
    }, 400);
  });

  // Agree button handler
  agreeBtn.addEventListener('click', () => {
    termsPopup.style.display = 'none';
    dashboard.style.display = 'flex';
    bookingForm.style.display = 'flex';
  });

  // Update booking data on form input changes
  bookingForm.addEventListener('input', e => {
    const tgt = e.target;
    booking[tgt.name] = tgt.value;
    updateCart();
  });

  // Prevent form submit default & alert (placeholder)
  bookingForm.addEventListener('submit', e => {
    e.preventDefault();
    alert('Booking submitted!\n(Integrate your backend here)');
  });
</script>
</body>
</html>